@using Microsoft.AspNetCore.Authentication
@using Microsoft.AspNetCore.Mvc
@using Microsoft.AspNetCore.Mvc.Razor
@using System.Security.Claims
@inject IHttpContextAccessor HttpContextAccessor
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery antiforgery


@{
    // Razor: åˆ¤æ–·ç›®å‰æ˜¯å¦ç™»å…¥
    var customerAuth = await HttpContextAccessor.HttpContext.AuthenticateAsync("CustomerAuth");
    var isCustomerLoggedIn = customerAuth?.Principal?.Identity?.IsAuthenticated ?? false;
    var isHomePage =
        string.Equals(ViewContext.RouteData.Values["controller"]?.ToString(), "Home", StringComparison.OrdinalIgnoreCase) &&
        string.Equals(ViewContext.RouteData.Values["action"]?.ToString(), "Index", StringComparison.OrdinalIgnoreCase) &&
        string.Equals(ViewContext.RouteData.Values["area"]?.ToString(), "CustomersArea", StringComparison.OrdinalIgnoreCase);
    string levelClass = "badge-iron"; // default
    
    string customerName = "";
    string customerLevelName = "";


    if (isCustomerLoggedIn)
    {
        var claims = customerAuth.Principal.Claims;
        customerName = claims.FirstOrDefault(c => c.Type == "FullName")?.Value ?? "";
        customerLevelName = claims.FirstOrDefault(c => c.Type == "LevelName")?.Value ?? "";
        levelClass = customerLevelName switch
        {
            "Iron" => "badge-iron",
            "Bronze" => "badge-bronze",
            "Silver" => "badge-silver",
            "Gold" => "badge-gold",
            _ => "badge-iron"
        };
    }
}

<!DOCTYPE html>
<html lang="en">
<head>
    <!-- head -->
    <link rel="manifest" href="~/CustomersArea/manifest.json?v=3">
    <meta name="theme-color" content="#22B3C1">
    <link rel="icon" type="image/png" href="~/CustomersArea/icon-192.png?v=3">
    @* ç°¡æ˜“pwa *@

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>è²“çˆªè¶³è·¡-@ViewData["Title"]</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Chiron+GoRound+TC:wght@200..900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.min.css" rel="stylesheet">
    <link href="~/front-end/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/front-end/assets/css/fontawesome.css" />
    <link rel="stylesheet" href="~/front-end/assets/css/templatemo-woox-travel.css" />
    <link rel="stylesheet" href="~/front-end/assets/css/owl.css" />
    <link rel="stylesheet" href="~/front-end/assets/css/animate.css" />
    <link rel="stylesheet" href="https://unpkg.com/swiper@7/swiper-bundle.min.css" />
    @RenderSection("Styles", required: false)

    <style>
        .badge-iron {
            background-color: #6c757d !important; /* ç° */
        }

        .badge-bronze {
            background-color: #cd7f32 !important; /* éŠ…è‰² */
        }

        .badge-silver {
            background-color: #c0c0c0 !important; /* éŠ€è‰² */
            color: black !important;
        }

        .badge-gold {
            background-color: #ffd700 !important; /* é‡‘è‰² */
            color: black !important;
        }

    </style>
</head>
<body>
    <!-- ***** Preloader Start ***** -->
    <div id="js-preloader" class="js-preloader">
        <div class="preloader-inner">
            <span class="dot"></span>
            <div class="dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </div>
    <!-- ***** Preloader End ***** -->
    <!-- ç‹€æ…‹æç¤ºï¼šè¨ªå®¢/æœƒå“¡ -->
    @* é¡¯ç¤ºç›®å‰ç™»å…¥ç‹€æ…‹ï¼Œæ–¹ä¾¿è‡ªæˆ‘æ¸¬è©¦èˆ‡ UXæå‡ *@
    @* @if (isCustomerLoggedIn)
    {
        <div class="alert alert-success text-center my-2">
            æ‚¨å·²ç™»å…¥ï¼Œæ­¡è¿ä½¿ç”¨æœƒå“¡å°ˆå€åŠŸèƒ½ï¼
        </div>
    }
    else
    {
        <div class="alert alert-warning text-center my-2">
            æ‚¨ç›®å‰ç‚ºè¨ªå®¢ï¼Œéƒ¨åˆ†åŠŸèƒ½éœ€ç™»å…¥æ‰èƒ½ä½¿ç”¨ã€‚
        </div>
    } *@

    <!-- Header -->
    <header class="site-header">
        <nav class="navbar navbar-expand-lg container-fluid py-2">
            <a class="navbar-brand brand-logo" asp-area="CustomersArea" asp-controller="Home" asp-action="Index" aria-label="é¦–é ">
                <img src="~/images/logo.png" alt="logo" style="width:60px; height:60px;" />
                <span class="fs-2">è²“çˆªè¶³è·¡</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="åˆ‡æ›é¸å–®">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="nav">
                <ul class="navbar-nav ms-auto mb-2 me-5 mb-lg-0 justify-content-between">
                    <li class="nav-item border-end me-1 p-1"><a class="nav-link" href="#hotProducts" id="navTripLink"><span class="link-text">è·Ÿåœ˜è¡Œç¨‹</span></a></li>
                    <li class="nav-item border-end me-1 p-1"><a class="nav-link" href="#featured-tickets" id="navLocaLink"><span class="link-text">æ™¯é»é–€ç¥¨</span></a></li>
                    <li class="nav-item border-end me-1 p-1"><a class="nav-link" href="#featured-hotels" id="navHotelLink"><span class="link-text">ä½å®¿</span></a></li>
                    <li class="nav-item border-end me-1 p-1"><a class="nav-link" href="#featured-transports" id="navTransLink"><span class="link-text">äº¤é€š</span></a></li>
                    <li class="nav-item border-end me-1 p-1"><a class="nav-link" href="#promotions"><span class="link-text">å„ªæƒ æ´»å‹•</span></a></li>
                    <!-- å¹«åŠ©ä¸­å¿ƒä¸‹æ‹‰é¸å–® -->
                    <li class="nav-item dropdown border-end me-1 p-1">
                        <a class="nav-link dropdown-toggle" href="#" id="helpDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <span class="link-text">å¹«åŠ©ä¸­å¿ƒ</span>
                        </a>
                        <ul class="dropdown-menu shadow-sm rounded-3" aria-labelledby="helpDropdown">
                            <li>
                                <a class="dropdown-item faq-nav-link" href="#faqSection">
                                    <i class="fa-solid fa-circle-info me-2 text-primary"></i> å¸¸è¦‹å•é¡Œ
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" asp-area="CustomersArea" asp-controller="Contact" asp-action="Index">
                                    <i class="fa-solid fa-envelope me-2 text-primary"></i> è¯çµ¡æˆ‘å€‘
                                </a>
                            </li>
                        </ul>
                    </li>

                    <li class="nav-item p-1">
                        <a class="nav-link" asp-controller="Travel" asp-action="index"><span class="link-text">è‡ªç”±è¡Œå°ˆå€</span></a>
                    </li>
                </ul>
                <div class="header-right d-flex align-items-center">
                    <nav class="main-nav flex-grow-1">
                        <ul class="nav align-items-center mb-0 w-100">
                            @if (isCustomerLoggedIn)
                            {
                                @* <li class="nav-item ms-auto me-1">
                                    <a href="#" class="nav-link">
                                       <span class="link-text"><i class="fa-solid fa-calendar-check me-1"></i>æ¯æ—¥ç°½åˆ°</span>
                                    </a>
                                </li> *@
                                <li class="nav-item me-1 dropdown notification-dropdown position-relative">
                                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                        <span class="link-text"><i class="fa-solid fa-bell"></i> é€šçŸ¥</span>
                                        <span id="notifBadge"
                                              class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                                              style="display:none; font-size:0.7rem;">
                                        </span>
                                    </a>
                                    <div class="dropdown-menu shadow p-0 notif-dropdown" data-bs-popper="none">
                                        <div class="p-3 border-bottom fw-bold d-flex justify-content-between align-items-center">
                                            <span>æœ€æ–°é€šçŸ¥</span>
                                            <button id="markAllReadBtnNavbar"
                                                    class="btn btn-sm btn-outline-primary rounded-pill px-3 py-0"
                                                    style="font-size:0.8rem;">
                                                å…¨éƒ¨å·²è®€
                                            </button>
                                        </div>
                                        <div id="notifList" class="overflow-auto" style="max-height:400px; max-width:320px;">
                                            <div class="text-center text-muted py-3">ç›®å‰æ²’æœ‰é€šçŸ¥</div>
                                        </div>
                                        <div class="p-2 text-center border-top" style="cursor:pointer"
                                             onclick="window.location.href='/CustomersArea/Notifications/Index'">
                                            <span class="text-decoration-none small text-primary">æŸ¥çœ‹æ‰€æœ‰é€šçŸ¥</span>
                                        </div>
                                    </div>
                                </li>
                                <li class="nav-item me-1">
                                    <a href="/CustomersArea/Cart" class="nav-link">
                                        <span class="link-text"><i class="fa-solid fa-cart-shopping me-1"></i>è³¼ç‰©è»Š</span><span class="badge bg-danger" id="cart-count">0</span>
                                    </a>
                                </li>
                                <li class="nav-item dropdown">
                                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                                        <span class="link-text">
                                            <i class="fa-solid fa-user me-1"></i>
                                            @if (isCustomerLoggedIn)
                                            {
                                                @customerName
                                                @if (!string.IsNullOrEmpty(customerLevelName))
                                                {
                                                    
                                                    <span class="badge @levelClass ms-1">@customerLevelName</span>
                                                }
                                            }
                                            else
                                            {
                                                @:æœƒå“¡ä¸­å¿ƒ
                                            }
                                        </span>
                                    </a>
                                    <ul class="dropdown-menu dropdown-menu-end mt-2 shadow user-dropdown">
                                        <li>
                                            <a class="dropdown-item" href="/CustomersArea/Orders/Index">
                                                <i class="fa-solid fa-file-invoice me-2"></i> è¨‚å–®ç´€éŒ„
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" asp-area="CustomersArea" asp-controller="CustomerService" asp-action="Index">
                                                <i class="fa-solid fa-headset me-2"></i> å®¢æœä¸­å¿ƒ
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" asp-area="CustomersArea" asp-controller="CusLogReg" asp-action="EditProfile">
                                                <i class="fa-solid fa-user-pen me-2"></i> æœƒå“¡è³‡æ–™
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" asp-area="CustomersArea" asp-controller="CusLogReg" asp-action="ResetPasswordIslogin">
                                                <i class="fa-solid fa-key me-2"></i> è®Šæ›´å¯†ç¢¼
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" asp-area="CustomersArea" asp-controller="Coupons" asp-action="Index">
                                                <i class="fa-solid fa-ticket me-2"></i> æˆ‘çš„å„ªæƒ åˆ¸
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" asp-area="CustomersArea" asp-controller="Favorites" asp-action="List">
                                                <i class="fa-solid fa-heart me-2"></i> æˆ‘çš„æ”¶è—
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="/CustomersArea/cus-join.html">
                                                <i class="fa-solid fa-users-viewfinder me-2"></i> åŠ å…¥ç¾¤çµ„
                                            </a>
                                        </li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li class="d-flex justify-content-end pe-2">
                                            <form asp-action="Logout" asp-controller="CusLogReg" asp-area="CustomersArea" method="post">
                                                @Html.AntiForgeryToken()
                                                <button type="submit"
                                                        class="dropdown-item text-danger d-inline-flex align-items-center"
                                                        style="background:none;border:none;width:auto;">
                                                    <span class="text-danger me-2">ç™»å‡º</span>
                                                    <i class="fa-solid fa-right-from-bracket" style="color:#dc3545"></i>
                                                </button>
                                            </form>
                                        </li>
                                    </ul>
                                </li>
                            }
                            else
                            {
                                <li class="nav-item ms-auto d-flex gap-2">
                                    <a href="/CustomersArea/CusLogReg/Login" class="btn btn-outline-primary rounded-pill">ç™»å…¥</a>
                                    <a href="/CustomersArea/CusLogReg/Register" class="btn btn-outline-primary rounded-pill">è¨»å†Š</a>
                                </li>
                            }
                        </ul>
                    </nav>
                </div>
            </div>
        </nav>
    </header>

    <div class="container-fluid p-0">
        @RenderBody()
    </div>

    <!-- Footer -->
    <footer class="cat-footer">
        <div class="cat-footer-inner container py-5">
            <div class="row gy-4">
                <!-- å“ç‰Œ -->
                <div class="col-12 col-md-4">
                    <div class="footer-brand">
                        <img src="~/images/logo.png" alt="logo" class="footer-logo">
                        <h4 class="mt-2 fw-bold text-white">è²“çˆªè¶³è·¡</h4>
                        <p class="small text-light">
                            å¸¶è‘—æ¯›å­©ä¸€èµ·å‡ºéŠå§ï¼æ¢ç´¢æœ€å¯æ„›ã€æœ€æº«æš–çš„æ—…ç¨‹é«”é©—ã€‚
                        </p>
                    </div>
                </div>

                <!-- å°è¦½é€£çµ -->
                <div class="col-6 col-md-2">
                    <h6 class="footer-title">æ¢ç´¢</h6>
                    <ul class="footer-links list-unstyled small">
                        <li><a href="#">ç†±é–€è¡Œç¨‹</a></li>
                        <li><a href="#">ä½å®¿æ¨è–¦</a></li>
                        <li><a href="#">äº¤é€šç¥¨åˆ¸</a></li>
                        <li><a href="#">ä¸»é¡Œä¼åŠƒ</a></li>
                    </ul>
                </div>

                <!-- å¹«åŠ©ä¸­å¿ƒ -->
                <div class="col-6 col-md-2">
                    <h6 class="footer-title">å¹«åŠ©ä¸­å¿ƒ</h6>
                    <ul class="footer-links list-unstyled small">
                        <li><a href="/CustomersArea/FAQs/Index">å¸¸è¦‹å•é¡Œ</a></li>
                        <li><a href="/CustomersArea/Contact/Index">è¯çµ¡æˆ‘å€‘</a></li>
                        <li><a href="#">è¨‚å–®æŸ¥è©¢</a></li>
                        <li><a href="#">é€€æ¬¾æ”¿ç­–</a></li>
                    </ul>
                </div>

                <!-- è¯çµ¡ / ç¤¾ç¾¤ -->
                <div class="col-12 col-md-4">
                    <h6 class="footer-title">è¿½è¹¤æˆ‘å€‘</h6>
                    <div class="footer-social">
                        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                    </div>
                    <p class="small mt-3 text-light">
                        å®¢æœä¿¡ç®±ï¼š<a href="mailto:service@catpaw.com.tw" class="text-white">service@catpaw.com.tw</a>
                    </p>
                </div>
            </div>
        </div>

        <div class="footer-bottom text-center text-light py-3 small">
            <div>Â© 2025 è²“çˆªè¶³è·¡ | ç”± FUEN43 Group 2 è£½ä½œ ğŸ¾</div>
        </div>

        <!-- èƒŒæ™¯è£é£¾ -->
        <div class="footer-paw-bg"></div>
    </footer>


    <!-- Back to top -->
    <div class="back-to-top" id="backToTop">
        <i class="fa-solid fa-paw"></i>
    </div>




    <!-- Scripts -->
    <!-- jQuery  -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Popper & Bootstrap  -->
    <script src="https://cdn.jsdelivr.net/npm/@@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- å¤–éƒ¨åŠŸèƒ½åº« -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.8/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.all.min.js"></script>
    <!-- å°ˆæ¡ˆ JS -->
    <script src="~/front-end/assets/js/isotope.min.js"></script>
    <script src="~/front-end/assets/js/owl-carousel.js"></script>
    <script src="~/front-end/assets/js/tabs.js"></script>
    <script src="~/front-end/assets/js/popup.js"></script>
    <script src="~/front-end/assets/js/custom.js"></script>
    <script src="~/front-end/assets/js/webFront.js"></script>

    @RenderSection("Scripts", required: false)
</body>
</html>